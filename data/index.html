<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESP32 Web Server</title>
  <!-- Include p5.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  
<link rel="stylesheet" type="text/css" href="style.css">
<!-- jQuery first, then Popper.js, then Bootstrap JS & CSS-->
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body class='fixed-nav sticky-footer bg-transparent sidenav-toggled ' id='page-top'>
  <!-- The display frame div -->
  <div id="canvasDiv"></div> 
    <div class='content-wrapper bg-transparent'>
    <div class='container-fluid text-center '>  

        <div class="topnav">
            <a class="active" href="index.html">Home</a>
            <a href="tides.html">Tides</a>
            <a href="#mqtt">MQTTViewer</a>
            <a href="about.html">About</a>
          </div>

  <h1>ESP32 Web Server</h1>

  <form class = 'card'>
    <h3>Weather</h3>
    <p>Temperature: <strong> %TEMP%</strong></p>
    <p>Pression: <strong> %PRESSION%</strong></p>
    <h3>Boat Stats</h3>
    <p>Speed: <strong> %SPEED%</strong></p>
    <p>Direction: <strong> %DIR%</strong></p>
    <p><a href="/speedUp"><button class="button button2">Speed Up</button></a></p>
    <p><a href="/slowDown"><button class="button ">Slow Down</button></a></p>
 </form>

  <p>GPIO state: <strong> %STATE%</strong></p>
  <p>
    <a href="/on"><button class="button">ON</button></a>
    <a href="/off"><button class="button button2">OFF</button></a>
  </p>
  </br></br><p></p></br>

  <p><a href="/data"><button class="button">GetData</button></a></p>
  </br>
  <p>Current Time   --   %TIME%</p>
  <p>Local IP   --   %LOCALIP% </p>
  <p>SSID   --   %SSID% </p>      

  <p>
    latitude: <span id="latitude"></span>&deg;<br />
    longitude: <span id="longitude"></span>&deg;
  </p>

  <form>
    <input type="text" id="ssid" value="UG">
    <input type="password" id="pass" value="***">
    <button class="button" onclick=changeSSID()>Set WiFi SSID</button>
    
    <br>

    <input type="text" id="IP0mqtt" size="3" maxlength="3" value="%IP0%">.
    <input type="text" id="IP1mqtt" size="3" maxlength="3" value="%IP1%">.
    <input type="text" id="IP2mqtt" size="3" maxlength="3" value="%IP2%">.
    <input type="text" id="IP3mqtt" size="3" maxlength="3" value="%IP3%">
  
    <input type="text" id="mqttport" value="1883">
    <button class="button" onclick=changeIP()>Set MQTT Server </button>
  </form>

  </div>
  </div>
  <script src="walker.js"></script>





  <script>
    async function changeSSID() 
    {
        let ssid = document.getElementById("ssid").value
        let pass = document.getElementById("pass").value
    
        const data = { ssid, pass };
        const options = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        };
        const response = await fetch('/ssid', options);
        const respjson = await response.json();
        console.log(respjson);
    }
    
    
    async function changeIP() 
    {
        let ip0 = document.getElementById("IP0mqtt").value
        let ip1 = document.getElementById("IP1mqtt").value
        let ip2 = document.getElementById("IP2mqtt").value
        let ip3 = document.getElementById("IP3mqtt").value
    
        let port = document.getElementById("mqttport").value
        const data = { ip0, ip1, ip2, ip3, port };
        const options = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        };
        const response = await fetch('/mqttip', options);
        const respjson = await response.json();
        console.log(respjson);
    }
    
  </script>

</body>
</html>
